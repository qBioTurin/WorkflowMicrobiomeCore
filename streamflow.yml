#!/usr/bin/env streamflow
version: v1.0
workflows:
  workflow:
    type: cwl
    config:
      file: workflowKraken2.cwl
      settings: config.yml
    bindings:
      - step: /zerothstep
        target:
          deployment: docker-genomemapper
      - step: /genomemapper_hg38 
        target:
          deployment: slurm-genomemapper
          workdir: /beegfs/home/scontald/sf_tmp
      - step: /kraken2 
        target:
          deployment: slurm-kraken2
          workdir: /beegfs/home/scontald/sf_tmp
      - step: /kraken-biom 
        target:
          deployment: slurm-kraken2
          workdir: /beegfs/home/scontald/sf_tmp
      - step: /metaphlan4
        target:
          deployment: slurm-metaphlan4
          workdir: /beegfs/home/scontald/sf_tmp
      - step: /merge_bioms
        target:
          deployment: slurm-metaphlan4
          workdir: /beegfs/home/scontald/sf_tmp
        

deployments:
  slurm-genomemapper:
    type: slurm
    config:
      hostname: c3sfr1.di.unito.it
      username: scontald
      sshKey: /home/scontaldo/.ssh/id_rsa  
      maxConcurrentJobs: 10
      file: ./sbatch/genomeMapper.sh
  slurm-kraken2:
    type: slurm
    config:
      hostname: c3sfr1.di.unito.it
      username: scontald
      sshKey: /home/scontaldo/.ssh/id_rsa  
      maxConcurrentJobs: 10
      file: ./sbatch/kraken2.sh
  slurm-metaphlan4:
    type: slurm
    config:
      hostname: c3sfr1.di.unito.it
      username: scontald
      sshKey: /home/scontaldo/.ssh/id_rsa  
      maxConcurrentJobs: 10
      file: ./sbatch/metaphlan4.sh
  docker-genomemapper:
    type: docker
    config: 
      image: qbioturin/genomemapper
